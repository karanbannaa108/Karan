<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>KaranZeroDay — Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Inter,system-ui,Arial;background:#071022;color:#fff;padding:32px}
    .card{max-width:480px;margin:40px auto;padding:28px;border-radius:12px;background:#0b1723;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
    input{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:#091221;color:#fff}
    button{width:100%;padding:12px;border:0;border-radius:8px;margin-top:8px;cursor:pointer}
    .primary{background:linear-gradient(90deg,#7b2eff,#5fb6ff);color:#fff}
    .discord{background:#5865f2;color:#fff}
    .note{font-size:12px;color:#9aa6b2;margin-top:10px}
  </style>
</head>
<body>
  <div class="card">
    <h2>KaranZeroDay — Login</h2>
    <input id="name" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button id="loginBtn" class="primary">Login</button>
    <button id="discordBtn" class="discord">Login with Discord</button>
    <div class="note">If frontend and backend are on different domains, cookies will be sent with credentials. Make sure FRONTEND_URL is configured on the backend.</div>
  </div>

<script>
  // Set BASE_API to your Railway backend URL. If you leave empty, it will use relative path.
  const BASE_API = window.BASE_API || ''; // set by server-deployer or edit this file to the exact URL

  async function postJSON(url, data){
    const res = await fetch(url, {
      method:'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    return res.json();
  }

  document.getElementById('loginBtn').addEventListener('click', async () => {
    const name = document.getElementById('name').value.trim();
    const password = document.getElementById('password').value;
    if(!name || !password){ alert('Enter name and password'); return; }
    const resp = await postJSON((BASE_API||'') + '/auth/login', { name, password });
    if(resp.success) { alert('Logged in'); location.reload(); }
    else alert(resp.error || 'Login failed');
  });

  document.getElementById('discordBtn').onclick = () => {
    window.location.href = (BASE_API||'') + '/auth/discord';
  };

  // Simple check for login
  (async () => {
    try {
      const r = await fetch((BASE_API||'') + '/me', { credentials: 'include' });
      const j = await r.json();
      if(j) {
        // already logged in
        window.location.href = '/';
      }
    } catch(e){}
  })();
</script>
</body>
</html>
